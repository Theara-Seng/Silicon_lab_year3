C51 COMPILER V9.60.0.0   HC_SR04                                                           05/12/2021 21:29:10 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE HC_SR04
OBJECT MODULE PLACED IN .\src\HC-SR04.OBJ
COMPILER INVOKED BY: c:\SiliconLabs\SimplicityStudio\v5\developer\toolchains\keil_8051\9.60\BIN\C51.exe D:\year4-semeste
                    -r2\Silicon_lab_year3\Ultrasonic_sensor\src\HC-SR04.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY
                    -(3) OPTIMIZE(0,SPEED) DEFINE(DEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(D:\year4-semester2\Silicon_lab_year3\Ultrasoni
                    -c_sensor\inc;C:/SiliconLabs/SimplicityStudio/v5/developer/sdks/8051/v4.2.0//Device/shared/si8051Base;C:/SiliconLabs/Simp
                    -licityStudio/v5/developer/sdks/8051/v4.2.0//Device/EFM8LB1/inc) PRINT(.\src\HC-SR04.lst) COND PAGEWIDTH(120) PAGELENGTH(
                    -65) OBJECT(.\src\HC-SR04.OBJ)

line level    source

   1          /*
   2           * HC-SR04.c
   3           *
   4           *  Created on: Apr 22, 2021
   5           *      Author: sengt
   6           */
   7          
   8          
   9          #include "HC-SR04.h"
  10          
  11          uint8_t  hc_sr04_get_distance(uint16_t *distance){
  12   1        uint16_t duration;
  13   1         uint8_t i=0;
  14   1      //   float sound_duration;
  15   1        // float sound_velocity=17;
  16   1        // float clock_period=1.95*pow(10,-3);
  17   1         TMOD |= TMOD_T0M__MODE1;
  18   1         TH0=0X00;
  19   1         TL0=0X00;
  20   1      
  21   1      
  22   1        HC_SR04_TRIGGER=0;
  23   1        HC_SR04_TRIGGER=1;
  24   1        for (i=0;i<12;i++){
  25   2          //  __NOP();
  26   2        }
  27   1       //  delay_ms(0.1);
  28   1         HC_SR04_TRIGGER=0;
  29   1      
  30   1         while (!HC_SR04_ECHO)
  31   1         TCON_TR0=1;
  32   1         while(HC_SR04_ECHO);
  33   1         TCON_TR0=0;
  34   1         if (TCON_TF0){
  35   2             TCON_TF0=0;
  36   2             return HC_SR04_OUT_OF_RANGE;
  37   2         }
  38   1      
  39   1         duration=(TH0<<8)|TL0;
  40   1       //  sound_duration=clock_period*sound_velocity;
  41   1         *distance=(int)(duration*17*195);
  42   1      
  43   1          return HC_SR04_SUCCESS;
  44   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    112    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   HC_SR04                                                           05/12/2021 21:29:10 PAGE 2   

   DATA SIZE        =      6    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
